<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ชั้นหนังสือ</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Georgia',serif;background:#0f0f0f;color:#eee;padding:20px;display:flex;justify-content:center}
        .container{max-width:900px;width:100%;background:#1f1f1f;padding:24px;border-radius:8px}
        h1{color:#ffd166;margin-bottom:12px}
        .section{background:#252525;padding:14px;border-radius:8px;margin-bottom:12px}
        .cards{display:flex;gap:12px;flex-wrap:wrap}
        .card{width:180px;background:#333;padding:8px;border-radius:6px}
        .card img{width:100%;height:220px;object-fit:cover;border-radius:4px;margin-bottom:8px}
        .card h3{font-size:15px;color:#fff;margin-bottom:6px}
        .card p{font-size:13px;color:#ccc;margin-bottom:8px}
        .card .actions{display:flex;gap:8px}
        .btn{padding:6px 8px;border-radius:6px;border:none;cursor:pointer}
        .btn.open{background:#0066cc;color:#fff}
        .btn.unfollow{background:#b30000;color:#fff}
        .meta{color:#aaa;font-size:13px;margin-bottom:8px}
        .empty{color:#888}
    </style>
</head>
<body>
    <div class="container">
        <h1>ชั้นหนังสือของฉัน</h1>

        <section class="section" id="recentSection">
            <div class="meta">อ่านล่าสุด</div>
            <div class="cards" id="recentCards"></div>
            <div style="margin-top:8px;"><button id="clearRecent" class="btn">ล้างประวัติ</button></div>
        </section>

        <section class="section" id="followSection">
            <div class="meta">นิยายที่ติดตาม</div>
            <div class="cards" id="followCards"></div>
        </section>

    </div>

    <script>
        function renderRecentlyRead() {
            const container = document.getElementById('recentCards');
            const arr = JSON.parse(localStorage.getItem('recentlyRead') || '[]');
            container.innerHTML = '';
            if (!arr.length) { container.innerHTML = '<div class="empty">ยังไม่มีประวัติการอ่าน</div>'; return; }
            arr.forEach(n => {
                const card = document.createElement('div'); card.className='card';
                card.innerHTML = `<img src="${n.cover}" alt="${n.title}"><h3>${n.title}</h3><p>${n.author}</p>`;
                const actions = document.createElement('div'); actions.className='actions';
                const open = document.createElement('button'); open.className='btn open'; open.textContent='เปิดอ่าน';
                open.addEventListener('click', ()=>{ localStorage.setItem('selectedNovel', JSON.stringify(n)); window.location.href='reader.html'; });
                const unfollow = document.createElement('button'); unfollow.className='btn unfollow'; unfollow.textContent='เลิกติดตาม';
                unfollow.addEventListener('click', ()=>{ // also remove from followed if exists
                    const ids = JSON.parse(localStorage.getItem('followedNovels') || '[]').filter(i => i !== n.id);
                    localStorage.setItem('followedNovels', JSON.stringify(ids));
                    localStorage.removeItem('followedNovel_' + n.id);
                    renderFollowed();
                });
                actions.appendChild(open); actions.appendChild(unfollow);
                card.appendChild(actions);
                container.appendChild(card);
            });
        }

        function renderFollowed() {
            const container = document.getElementById('followCards');
            const ids = JSON.parse(localStorage.getItem('followedNovels') || '[]');
            container.innerHTML = '';
            if (!ids.length) { container.innerHTML = '<div class="empty">ยังไม่มีนิยายที่ติดตาม</div>'; return; }
            ids.forEach(id => {
                const raw = localStorage.getItem('followedNovel_' + id);
                if (!raw) return;
                const n = JSON.parse(raw);
                const card = document.createElement('div'); card.className='card';
                card.innerHTML = `<img src="${n.cover}" alt="${n.title}"><h3>${n.title}</h3><p>${n.author}</p>`;
                const actions = document.createElement('div'); actions.className='actions';
                const open = document.createElement('button'); open.className='btn open'; open.textContent='เปิดอ่าน';
                open.addEventListener('click', ()=>{ localStorage.setItem('selectedNovel', JSON.stringify(n)); window.location.href='reader.html'; });
                const unfollow = document.createElement('button'); unfollow.className='btn unfollow'; unfollow.textContent='เลิกติดตาม';
                unfollow.addEventListener('click', ()=>{
                    const newIds = JSON.parse(localStorage.getItem('followedNovels') || '[]').filter(i => i !== n.id);
                    localStorage.setItem('followedNovels', JSON.stringify(newIds));
                    localStorage.removeItem('followedNovel_' + n.id);
                    renderFollowed();
                });
                actions.appendChild(open); actions.appendChild(unfollow);
                card.appendChild(actions);
                container.appendChild(card);
            });
        }

        document.getElementById('clearRecent').addEventListener('click', ()=>{ localStorage.removeItem('recentlyRead'); renderRecentlyRead(); });

        renderRecentlyRead();
        renderFollowed();
    </script>
</body>
</html>
